<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <!-- å¼•å…¥ ECharts æ–‡ä»¶ -->
  <script src="../echarts.min.js"></script>
  <script src="../d3.v5.min.js"></script>
  <script src="../jquery.js"></script>
  <script src="geojs/world.js"></script>
  <title>å¯è§†åŒ–å¤§ä½œä¸š</title>
</head>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
  }

  body {

    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-width: 1000px;
    z-index: -10;
    zoom: 1;
    background-color: rgba(0,0,60,.85);
  }

  .box {
    position: absolute;

    z-index: 320;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    box-shadow: rgba(153,217,234, 0.9) 0px 0px 3px inset;
    background: linear-gradient(to left, #00A2E8, #00A2E8) left top no-repeat,
    linear-gradient(to bottom, #00A2E8, #00A2E8) left top no-repeat,
    linear-gradient(to left, #00A2E8, #00A2E8) right top no-repeat,
    linear-gradient(to bottom, #00A2E8, #00A2E8) right top no-repeat,
    linear-gradient(to left, #00A2E8, #00A2E8) left bottom no-repeat,
    linear-gradient(to bottom, #00A2E8, #00A2E8) left bottom no-repeat,
    linear-gradient(to left, #00A2E8, #00A2E8) right bottom no-repeat,
    linear-gradient(to left,#00A2E8, #00A2E8) right bottom no-repeat;
    background-size: 3px 10px, 10px 3px, 3px 10px, 10px 3px;
  }



  .gx path {
    /* //è®¾ç½®åæ ‡è½´æ•´ä¸ªé•¿çº¿çš„ */
    fill: none;
    stroke: white;
    shape-rendering: crispEdges;
  }

  .gx line {
    /* //è®¾ç½®åæ ‡è½´é•¿çº¿ä¸Šçš„å°é—´éš”çŸ­çº¿ */
    fill: none;
    stroke: white;
    shape-rendering: crispEdges;
  }

  .gx text {
    /* //è®¾ç½®åæ ‡è½´æ–‡å­— */
    font-family: sans-serif;
    font-size: 10px;
    color: white;
  }

  .yg path {
    /* //è®¾ç½®åæ ‡è½´æ•´ä¸ªé•¿çº¿çš„ */
    fill: none;
    stroke: white;
    shape-rendering: crispEdges;
  }

  .yg line {
    /* //è®¾ç½®åæ ‡è½´é•¿çº¿ä¸Šçš„å°é—´éš”çŸ­çº¿ */
    fill: none;
    stroke: white;
    shape-rendering: crispEdges;
  }

  .yg text {
    /* //è®¾ç½®åæ ‡è½´æ–‡å­— */
    font-family: sans-serif;
    font-size: 10px;
    color: white;
  }

  .button-56 {
    align-items: center;
    background-color: #fee6e3;
    border: 2px solid #fcfcfc;
    border-radius: 8px;
    box-sizing: border-box;
    color: #111;
    cursor: pointer;
    display: flex;
    font-family: Inter, sans-serif;
    font-size: 10px;
    height: 30px;
    justify-content: center;
    line-height: 24px;
    max-width: 100%;
    padding: 0 25px;
    position: absolute;
    top: 10px;
    right: 100px;
    text-align: center;
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }

  .button-56:after {
    background-color: #111;
    border-radius: 8px;
    content: "";
    display: block;
    height: 48px;
    left: 0;
    width: 100%;
    position: absolute;
    top: -2px;
    transform: translate(8px, 8px);
    transition: transform 0.2s ease-out;
    z-index: -1;
  }

  .button-56:hover:after {
    transform: translate(0, 0);
  }

  .button-56:active {
    background-color: #ffdeda;
    outline: 0;
  }

  .button-56:hover {
    outline: 0;
  }

  @media (min-width: 768px) {
    .button-56 {
      padding: 0 40px;
    }
  }
</style>

<body>

  <!-- èƒŒæ™¯å›¾ -->
  <div id="Layer1" style="position:fixed; left:0px; top:0px; width:100%; height:100%;opacity:1"><img src="svg/b.png" width="100%" height="100%"/></div>
  <!-- èœå•æ  -->
  <div id="menu" class="box" style="top: 10px; right: 392px; height: 89px; width: 759px"></div>
  <!-- åœ°å›¾å’Œæ¡å½¢å›¾ -->
  <div id="map-bar" class="box" style="top: 112px; right: 392px; height: 400px; width: 759px"></div>
  <!-- æ ‘å›¾ -->
  <div id="treemap" class="box" style="top: 400px; left: 10px; height: 335px; width: 350px"></div>
  <!-- æ—­æ—¥å›¾ -->
  <div id="container" class="box" style="top: 12px; left: 10px; height: 370px; width: 350px"></div>
  <!-- d3å †å æ¡å½¢å›¾ -->
  <div class="box" id="nsy" style="top: 10px; right: 10px; height: 501px; width: 368px">
    <button class="button-56" role="button" style="margin: auto" onclick="readAndDraw()">
      Change Order
    </button>
    <a href="d3Detail.html" style="
          color: white;
          position: absolute;
          top: 2px;
          left: 2px;
          font-size: 5px;
        ">è·³è½¬</a>
  </div>
  <!-- ä»ªè¡¨ç›˜æœºå™¨å­¦ä¹ æ¨¡å‹ -->
  <div id="hill" class="box" style="top: 530px; right: 372px; height: 200px; width: 780px"></div>
  <div id="svg" class="box" style="top: 530px; right: 10px; height: 200px; width: 348px"></div>
  <!-- æ—­æ—¥å›¾ -->
  <script>
    var dom = document.getElementById("container");
    var col = "Alcoholic Beverages";
    var myChart = echarts.init(dom);
    var option;
    const colors = [
      "#ff595e",
      "#fb5607",
      "#ff006e",
      "#8338ec",
      "#3a86ff",
      "#f72585",
      "#d100d1",
      "#cb0b0a",
      "#4361ee",
      "#4cc9f0",
      "#9e2a2b",
      "#2d00f7",
      "#5a189a",
      "#3c096c",
    ];
    const bgColor = "#0f2444";
    const itemStyle = {
      star0: {
        color: colors[0],
      },
      star1: {
        color: colors[1],
      },
      star2: {
        color: colors[2],
      },
      star3: {
        color: colors[3],
      },
      star4: {
        color: colors[4],
      },
      star5: {
        color: colors[5],
      },
      star6: {
        color: colors[6],
      },
      star7: {
        color: colors[7],
      },
      star8: {
        color: colors[8],
      },
      star9: {
        color: colors[9],
      },
      star10: {
        color: colors[10],
      },
      star11: {
        color: colors[11],
      },
      star12: {
        color: colors[12],
      },
    };
    const thedata = [
      {
        name: "\nğŸ¿ğŸ³ğŸ§‡ğŸ¥\né£Ÿç‰©ç§ç±»\nğŸ§€ğŸ¥—ğŸ§ˆğŸ¨\n\n\n\n",
        itemStyle: {
          color: colors[0], //ä¸­å¿ƒçš„é¢œè‰²
        },
        children: [
          {
            name: "ğŸºé…’ç²¾é¥®æ–™",
            children: [
              {
                name: "ğŸ¸ğŸ·ğŸ¶ğŸ¾",
                children: [
                  {
                    name: "é…¿é€ é…’",
                  },
                  {
                    name: "éœ²é…’",
                  },
                  {
                    name: "è’¸é¦é…’",
                  },
                ],
              },
            ],
          },
          {
            name: "å…¶ä»–",
            children: [
              {
                name: "ğŸ¯ğŸŒ´ğŸŒµğŸŒ¿",
                children: [
                  {
                    name: "å†…è„",
                  },
                  {
                    name: "æ²¹æ–™ä½œç‰©",
                  },
                  {
                    name: "è±†ç±»",
                  },
                  {
                    name: "é¦™æ–™",
                  },
                  {
                    name: "æ ‘åšæœ",
                  },
                  {
                    name: "æ¤ç‰©æ²¹",
                  },
                ],
              },
            ],
          },
          {
            name: "ğŸŸé±¼å’Œæµ·é²œ",
            children: [
              {
                name: "ğŸ¦ªğŸ¤ğŸ¥",
                children: [
                  {
                    name: "ç”²å£³åŠ¨ç‰©",
                  },
                  {
                    name: "è½¯ä½“åŠ¨ç‰©",
                  },
                  {
                    name: "æ·¡æ°´é±¼",
                  },
                  {
                    name: "åº•æ –é±¼",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
          {
            name: "ğŸšè°·ç‰©",
            children: [
              {
                name: "ğŸœğŸŒ¾ğŸ˜ğŸ",
                children: [
                  {
                    name: "ç‰ç±³ğŸŒ½",
                  },
                  {
                    name: "å¤§éº¦",
                  },
                  {
                    name: "å¤§ç±³",
                  },
                  {
                    name: "å°ç±³",
                  },
                  {
                    name: "é«˜ç²±",
                  },
                  {
                    name: "å°éº¦",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
          {
            name: "è›‹ç±»ğŸ¥š",
            children: [
              {
                name: "ğŸ¦†ğŸ“ğŸ¦¢ğŸ£",
                children: [
                  {
                    name: "é¸¡è›‹",
                  },
                  {
                    name: "é¸­è›‹",
                  },
                  {
                    name: "é¹Œé¹‘è›‹",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
          {
            name: "è‚‰ç±»ğŸ¥©",
            children: [
              {
                name: "ğŸ–ğŸ—ğŸ¥©",
                children: [
                  {
                    name: "ç‰›è‚‰ğŸ‚",
                  },
                  {
                    name: "ç¾Šè‚‰ğŸ",
                  },
                  {
                    name: "çŒªè‚‰ğŸ–",
                  },
                  {
                    name: "é¸¡è‚‰ğŸ”",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
          {
            name: "å¥¶ç±»ğŸ¥›",
            children: [
              {
                name: "ğŸ§‚ğŸ¼ğŸ¥›",
                children: [
                  {
                    name: "ç‰›å¥¶",
                  },
                  {
                    name: "ç¾Šå¥¶",
                  },
                  {
                    name: "éª†é©¼å¥¶",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
          {
            name: "ç³–å’Œç³–ç±»\nä½œç‰©ğŸ¬",
            children: [
              {
                name: "ğŸ¬ğŸ­ğŸ«",
                children: [
                  {
                    name: "ç”˜è”—",
                  },
                  {
                    name: "ç”œèœ",
                  },
                  {
                    name: "ç³–",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
          {
            name: "è”¬æœğŸ¥¦",
            children: [
              {
                name: "ğŸğŸ†ğŸ¥”ğŸŠ",
                children: [
                  {
                    name: "é»„ç“œğŸ¥’",
                  },
                  {
                    name: "ç•ªèŒ„ğŸ…",
                  },
                  {
                    name: "é¦™è•‰ğŸŒ",
                  },
                  {
                    name: "è‹¹æœğŸ",
                  },
                  {
                    name: "å…¶å®ƒ",
                  },
                ],
              },
            ],
          },
        ],
      },
    ];
    for (let j = 0; j < thedata.length; ++j) {
      let level1 = thedata[j].children;
      for (let i = 0; i < level1.length; ++i) {
        let block = level1[i].children;
        let bookScore = [];
        let bookScoreId;
        for (let star = 0; star < block.length; ++star) {
          let style = (function (name) {
            switch (name) {
              case "ğŸğŸ†ğŸ¥”ğŸŠ":
                bookScoreId = 0;
                return itemStyle.star1;
              case "ğŸ–ğŸ—ğŸ¥©":
                bookScoreId = 1;
                return itemStyle.star2;
              case "ğŸ¦ªğŸ¤ğŸ¥":
                bookScoreId = 2;
                return itemStyle.star3;
              case "ğŸœğŸŒ¾ğŸ˜ğŸ":
                bookScoreId = 3;
                return itemStyle.star4;
              case "ğŸ¸ğŸ·ğŸ¶ğŸ¾":
                bookScoreId = 4;
                return itemStyle.star5;
              case "ğŸ¯ğŸŒ´ğŸŒµğŸŒ¿":
                bookScoreId = 5;
                return itemStyle.star6;
              case "ğŸ¦†ğŸ“ğŸ¦¢ğŸ£":
                bookScoreId = 6;
                return itemStyle.star7;
              case "ğŸ§‚ğŸ¼ğŸ¥›":
                bookScoreId = 7;
                return itemStyle.star8;
              case "ğŸ¬ğŸ­ğŸ«":
                bookScoreId = 8;
                return itemStyle.star9;
            }
          })(block[star].name);
          block[star].label = {
            color: style.color,
            downplay: {
              opacity: 0.5,
            },
          };
          if (block[star].children) {
            style = {
              opacity: 1,
              color: style.color,
            };
            block[star].children.forEach(function (book) {
              book.value = 1;
              book.itemStyle = style;
              book.label = {
                color: style.color,
              };
              let value = 1;
              if (bookScoreId === 0 || bookScoreId === 3) {
                value = 5;
              }
              if (bookScore[bookScoreId]) {
                bookScore[bookScoreId].value += value;
              } else {
                bookScore[bookScoreId] = {
                  color: colors[bookScoreId],
                  value: value,
                };
              }
            });
          }
        }
        level1[i].itemStyle = {
          color: thedata[j].itemStyle.color,
        };
      }
    }
    option = {
      //backgroundColor: bgColor, //èƒŒæ™¯é¢œè‰²
      color: colors,
      series: [
        {
          type: "sunburst",
          center: ["50%", "50%"],
          data: thedata,
          sort: function (a, b) {
            if (a.depth === 1) {
              return b.getValue() - a.getValue();
            } else {
              return a.dataIndex - b.dataIndex;
            }
          },
          label: {
            rotate: "radial",
            color: bgColor,
          },
          itemStyle: {
            borderColor: bgColor, //æ¡†çš„é¢œè‰²
            borderWidth: 2,
          },
          levels: [
            {},
            {
              r0: 0,
              r: 35,
              label: {
                rotate: 0, //ä¸­å¿ƒåœ†ä¸­å­—ç¬¦æ—‹è½¬è§’åº¦
              },
            },
            {
              r0: 40,
              r: 103,
            },
            {
              r0: 115,
              r: 140,
              itemStyle: {
                shadowBlur: 2,
                shadowColor: colors[2],
                color: "transparent",
              },
              label: {
                rotate: "tangential",
                fontSize: 10,
                color: colors[0],
              },
            },
            {
              r0: 140,
              r: 145,
              itemStyle: {
                shadowBlur: 80, //å…‰ç¯å¤§å°
                shadowColor: "colors[0]",
              },
              label: {
                position: "outside", //ä¸€åœˆå­—æ‰€å¤„ä½ç½®
                textShadowBlur: 5,
                textShadowColor: "#333",
              },
              downplay: {
                label: {
                  opacity: 0.5,
                },
              },
            },
          ],
        },
      ],
    };
    myChart.setOption(option);
    myChart.on("click", function (params) {
      if (params.dataIndex == 2) {
        col = "Alcoholic Beverages";
        changeView();
      } else if (params.dataIndex == 56) {
        col = "FruitsAndVegetabels";
        changeView();
      } else if (params.dataIndex == 37) {
        col = "Animal Products";
        changeView();
      } else if (params.dataIndex == 22) {
        col = "Cereals";
        changeView();
      } else if (params.dataIndex == 31) {
        col = "Eggs";
        changeView();
      } else if (params.dataIndex == 15) {
        col = "Seafood";
        changeView();
      } else if (params.dataIndex == 44) {
        col = "Milk";
        changeView();
      } else if (params.dataIndex == 50) {
        col = "Sugar";
        changeView();
      } else if (params.dataIndex == 7) {
        col = "Else";
        changeView();
      }
    });
  </script>
  <!-- èœå•éƒ¨åˆ† -->
  <script>
    var myMenu = echarts.init(document.getElementById("menu"));
    var tableName = "1";
    const MenuOption = {
      title: {
        left: 0,
        top: "middle",
        textStyle: {
          color: "#2ec4b6",
          fontSize: 25,
        },
        text: "  æ‘„å…¥ç±»å‹",
      },
      toolbox: {
        itemSize: 45,
        itemGap: 70,
        left: "30%",
        top: "middle",
        feature: {
          //è„‚è‚ªæ‘„å…¥é‡ç™¾åˆ†æ¯”æŒ‰é’®
          myFatbutton: {
            show: true,
            title: "è„‚è‚ªæ‘„å…¥é‡",
            icon: "image://svg/fat.svg",
            onclick: function () {
              tableName = "1";
              readData("1");

              chart = "1.csv";
              dataName = "data/" + chart;
              readdata(dataName);

              mapOption.series[0].data = data;
              mapOption.title.text =
                "ä¸–ç•Œå„å›½è„‚è‚ªæ‘„å…¥é‡æ¥è‡ªäº " + col + " çš„å æ¯”";
              barOption.series.data = data.map(function (item) {
                return item.value;
              });
              barOption.yAxis.data = data.map(function (item) {
                return item.name;
              });

              mychart.clear();
              changeOption(nowOption);
            },
          },
          //é£Ÿç‰©æ‘„å…¥é‡ç™¾åˆ†æ¯”
          myFoodbutton: {
            show: true,
            title: "é£Ÿç‰©æ‘„å…¥é‡",
            icon: "image://svg/rice.svg",
            onclick: function () {
              tableName = "3";
              readData("3");

              chart = "3.csv";
              dataName = "data/" + chart;
              readdata(dataName);

              mapOption.series[0].data = data;
              mapOption.title.text =
                "ä¸–ç•Œå„å›½é£Ÿç‰©æ‘„å…¥æ€»é‡æ¥è‡ªäº " + col + " çš„å æ¯”";
              barOption.series.data = data.map(function (item) {
                return item.value;
              });
              barOption.yAxis.data = data.map(function (item) {
                return item.name;
              });
              mychart.clear();
              changeOption(nowOption);
            },
          },
          //çƒ­é‡æ‘„å…¥é‡ç™¾åˆ†æ¯”
          myKalulibutton: {
            show: true,
            title: "çƒ­é‡æ‘„å…¥é‡",
            icon: "image://svg/kaluli.svg",
            onclick: function () {
              tableName = "2";
              readData("2");

              chart = "2.csv";
              dataName = "data/" + chart;
              readdata(dataName);

              mapOption.series[0].data = data;
              mapOption.title.text =
                "ä¸–ç•Œå„å›½çƒ­é‡æ‘„å…¥æ¥è‡ªäº " + col + " çš„å æ¯”";
              barOption.series.data = data.map(function (item) {
                return item.value;
              });
              barOption.yAxis.data = data.map(function (item) {
                return item.name;
              });

              mychart.clear();
              changeOption(nowOption);
            },
          },
          //è›‹ç™½è´¨æ‘„å…¥é‡ç™¾åˆ†æ¯”
          myProteinbutton: {
            show: true,
            title: "è›‹ç™½è´¨æ‘„å…¥é‡",
            icon: "image://svg/protein.svg",
            onclick: function () {
              tableName = "4";
              readData("4");

              chart = "4.csv";
              dataName = "data/" + chart;
              readdata(dataName);

              mapOption.title.text =
                "ä¸–ç•Œå„å›½è›‹ç™½æ‘„å…¥æ¥è‡ªäº " + col + " çš„å æ¯”";
              mapOption.series[0].data = data;
              barOption.series.data = data.map(function (item) {
                return item.value;
              });
              barOption.yAxis.data = data.map(function (item) {
                return item.name;
              });
              mychart.clear();
              changeOption(nowOption);
            },
          },
        },
      },
    };
    myMenu.setOption(MenuOption, true);
  </script>
  <!-- çŸ©å½¢æ ‘å›¾ -->
  <script>
    //é€‰æ‹©å“ªä¸ªè¡¨
    var chart = "1.csv";
    //é€‰æ‹©å“ªä¸ªå›½å®¶
    var guojia = "Albania";

    // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
    var mytree = echarts.init(document.getElementById("treemap"));

    var dataName = "data/" + chart;

    //å­˜å‚¨æ–°æ•°æ®(name:+value:)
    var newData = new Array();
    //å­˜å‚¨æ¯ä¸ªvalue
    var valuerData = new Array();

    //å­˜å‚¨çŸ©é˜µæ ‘å›¾çš„æ•°æ®
    var treeData = new Array();
    var tmp = new Array();

    function readdata(dataName) {
      // console.log(dataName)
      newData = [];
      valuerData = [];
      treeData = [];
      tmp = [];
      d3.csv(dataName).then((dataSet) => {
        for (var i = 0; i < dataSet.length; i++) {
          if (dataSet[i].Country === guojia) tmp = dataSet[i];
        }
        // console.log(tmp);
        delete tmp.Country;

        for (x in tmp) {
          var p = {};
          p.name = x; //å¾—åˆ°å±æ€§å
          p.value = tmp[x]; //å¾—åˆ°å¯¹åº”å€¼
          var q = {};
          q.name = x;
          q.max = 60;

          newData.push(p); //å­˜å‚¨æ•°æ®
          valuerData.push(tmp[x]);
          if (x === "Else") break;
        }
        //å­˜å‚¨ElseåŒ…å«çš„å±æ€§
        var ElseData = new Array();

        var index = -1;
        for (x in tmp) {
          index++; //ç¬¬indexå±æ€§
          if (index >= 9 && index <= 19) {
            var p = {};
            p.name = x;
            p.value = tmp[x];
            ElseData.push(p);
          }
        }

        for (x in tmp) {
          var p = {};
          p.name = x; //å¾—åˆ°å±æ€§å
          p.value = tmp[x]; //å¾—åˆ°å¯¹åº”å€¼
          p.children = [];
          if (x === "Else") {
            p.children = ElseData;
            treeData.push(p);
            break;
          } else treeData.push(p);
        }

        var text;
        if (tableName === "1") {
          text = guojia + " è„‚è‚ªæ‘„å…¥çš„ç»„æˆç»“æ„";
        } else if (tableName === "2") {
          text = guojia + " çƒ­é‡æ‘„å…¥çš„ç»„æˆç»“æ„";
        } else if (tableName === "3") {
          text = guojia + " é£Ÿç‰©æ‘„å…¥æ€»é‡çš„ç»„æˆç»“æ„";
        } else if (tableName === "4") {
          text = guojia + " è›‹ç™½æ‘„å…¥é‡çš„ç»„æˆç»“æ„";
        }
        var treeOption = {
          color:["#f20089","#7209b7","#3a0ca3","#4361ee",
            "#4cc9f0","#db00b6","#b100e8","#2d00f7",
          "#6a00f4"],
          title: {
            text: text,
            textStyle: {
              color: "#ffbc42",
              fontSize: 10,
            },
          },
          toolbox: {
            show: true,
            feature: {
              restore: {
                show: false,
              },
            },
          },
          tooltip: {
            formatter: function (info) {
              var value = info.value;
              var treePathInfo = info.treePathInfo;
              var treePath = [];
              for (var i = 1; i < treePathInfo.length; i++) {
                treePath.push(treePathInfo[i].name);
              }
              return [
                "å›½å®¶: " + guojia,
                '<div class="tooltip-title">' +
                echarts.format.encodeHTML(treePath.join("/")) +
                "</div>",
                "å æ¯”: " + echarts.format.addCommas(value) + " %",
              ].join("");
            },
          },
          series: [
            {
              itemStyle: {
                gapWidth: 5,
                borderColor: "#0f2444",
              },
              type: "treemap",
              leafDepth: 1,
              data: treeData,
              width: "90%",
              height: "90%",
            },
          ],
        };

        var currentOption = treeOption;
        mytree.setOption(currentOption);
      });
    }

    readdata(dataName);
  </script>
  <!-- åœ°å›¾å’Œæ¡å½¢å›¾éƒ¨åˆ† -->
  <script>
    // æ•°æ®è¦å°†å—æœé²œåŒ—æœé²œçš„é€—å·å»æ‰
    // æ ‡é¢˜ç±»é‡Œçš„é€—å·ä¹Ÿå»æ‰
    var data = [];
    var filedata;

    var filePath = "data/" + tableName.toString() + ".csv";

    getCSV(filePath, function (data) {
      filedata = CSV(data);
      // console.log(thedata);
    });

    var data = filedata.map((item) => {
      var tmp = item["Country"];
      if (tmp === "United States of America") tmp = "United States";
      else if (tmp === "Russian Federation") tmp = "Russia";
      else if (tmp === "Iran (Islamic Republic of)") tmp = "Iran";
      else if (tmp === "Korea North") tmp = "Dem. Rep. Korea";
      else if (tmp === "Korea South") {
        tmp = "Korea";
      }
      // console.log(tmp[0]);
      // console.log(tmp[tmp.length - 1]);
      return {
        name: tmp,
        value: parseFloat(item[col]),
      };
    });

    var mychart = echarts.init(document.getElementById("map-bar"));

    //å¯¹æ•°æ®è¿›è¡Œæ’åº
    data.sort(function (a, b) {
      return a.value - b.value;
    });

    //åœ°å›¾çš„è®¾ç½®
    const mapOption = {
      //backgroundColor: "#0f2444", // å›¾è¡¨èƒŒæ™¯è‰²
      title: {
        text: "ä¸–ç•Œå„å›½è„‚è‚ªè¾“å…¥æ¥è‡ªäº " + col + " çš„å æ¯”",
        textStyle: {
          color: "#ffbc42",
        },
      },
      visualMap: {
        left: "left",
        min: 0,
        max: 60,
        inRange: {
          // prettier-ignore
          // color: ['#ffb600', '#ffaa00', '#ff9e00', '#ff9100', '#ff8500', '#ff7900', '#ff6d00', '#ff6000', '#ff5400', '#ff4800']
          // color: ['#fae0e4', '#f7cad0', '#f9bec7', '#fbb1bd', '#ff99ac', '#ff85a1', '#ff7096', '#ff5c8a', '#ff477e', '#ff0a54'],
          color: ['#ade8f4', '#90e0ef', '#48cae4', '#48cae4', '#00b4d8', '#0096c7', '#0077b6', '#023e8a'],
        },
        text: ["ä¸»è¦æ¥æº", "æ¬¡è¦æ¥æº"], //æŒ‡æ ‡å¤§å°çš„æ ‡ç­¾åå­—
        textStyle: {
          color: "#fff",
        },
        calculable: true,
      },
      series: [
        {
          id: "population",
          type: "map", //ç±»å‹ä¸ºåœ°å›¾
          itemStyle: {
            areaColor: "#caf0f8",
            borderColor: "#fff",
          },
          roam: true,
          map: "world", //ä¸–ç•Œåœ°å›¾
          label: {
            color: "#ffffe0",
            fontWeight: "bold",
          },
          //ç§»åŠ¨åˆ°ç›¸åº”åŒºåŸŸé«˜äº®å±•ç¤ºè®¾ç½®
          emphasis: {
            //æ–‡æœ¬
            label: {
              color: "#457b9d",
            },
            //åŒºåŸŸé¢œè‰²
            itemStyle: {
              areaColor: "#fffacd",
            },
          },
          //é€‰ä¸­åŒºåŸŸä¹‹åæ˜¾ç¤ºè®¾ç½®
          select: {
            label: {
              color: "#ffffe0",
            },
            itemStyle: {
              areaColor: "#ff85a1",
            },
          },

          zoom: 1.25,
          animationDurationUpdate: 1000,
          universalTransition: true, //è¿‡æ¸¡åŠ¨ç”»
          data: data,
        },
      ],
      tooltip: {
        trigger: "item",
        backgroundColor: "rgba(0,0,0,0.7)",
        transitionDuration: 0,
        textStyle: {
          color: "#fff",
          fontSize: 15,
        },
        formatter: "å›½å®¶ :  {b}<br/>æ‘„å…¥å æ¯” :  {c} %",
      },
      toolbox: {
        itemSize: 30,
        itemGap: 30,
        right: 50,
        feature: {
          //ä¿å­˜å›¾ç‰‡æŒ‰é’®
          saveAsImage: {
            //excludeComponents :['toolbox'],
            pixelRatio: 2,
            iconStyle: {
              borderColor: "#fff",
            },
          },
          //æ’¤é”€ä¿®æ”¹
          restore: {
            iconStyle: {
              borderColor: "#fff",
            },
          },
          //æ¡çŠ¶å›¾æŒ‰é’®
          mybarbotton: {
            show: true,
            title: "æ¡å½¢å›¾",
            icon: "image://svg/barchart.svg",
            onclick: function () {
              nowOption = 1;
              changeOption(1);
            },
          },
          //åœ°å›¾æŒ‰é’®
          mymapbutton: {
            show: true,
            title: "ä¸–ç•Œåœ°å›¾",
            icon: "image://svg/map.svg",
            onclick: function () {
              nowOption = 0;
              changeOption(0);
            },
          },
        },
      },
    };
    const barOption = {
      //backgroundColor: "#0f2444", // å›¾è¡¨èƒŒæ™¯è‰²
      //è®¾ç½®xè½´ä¸ºæ•°å€¼
      xAxis: {
        type: "value",
        axisLabel: {
          color: "#fff",
        },
      },
      //yè½´ä¸ºè‡ªå˜é‡
      yAxis: {
        type: "category",
        axisLabel: {
          rotate: 30,
          color: "#fff",
        },
        data: data.map(function (item) {
          return item.name;
        }),
      },
      //ç¼©æ”¾
      dataZoom: [
        {
          type: "inside",
          yAxisIndex: [0], //è®¾ç½®ä¸ºyè½´æŠ˜å 
        },
      ],
      animationDurationUpdate: 1000,

      series: {
        type: "bar",
        showBackground: true,
        id: "population",
        itemStyle: {
          color: function (params) {
            //å¾ªç¯çš„é¢œè‰²
            var colorList = [
              "#ffc09f",
              "#ffee93",
              "#fcf5c7",
              "#a0ced9",
              "#adf7b6",
            ];
            if (params.dataIndex >= colorList.length) {
              var index = params.dataIndex % colorList.length;
              return colorList[index];
            }
            return colorList[params.dataIndex];
          },
        },
        emphasis: {
          itemStyle: {
            color: "#ff4d6d",
          },
        },
        data: data.map(function (item) {
          return item.value;
        }),
        universalTransition: true,
      },
      //æ‚¬æµ®æ¡†æ˜¾ç¤ºä¿¡æ¯
      tooltip: {
        trigger: "axis",
        formatter: "å›½å®¶ :  {b}<br/>æ‘„å…¥å æ¯” :  {c} %",
      },
      //æŒ‰é’®è®¾ç½®
      toolbox: {
        itemSize: 30,
        itemGap: 30,
        right: 50,
        feature: {
          //ä¿å­˜å›¾ç‰‡æŒ‰é’®
          saveAsImage: {
            //excludeComponents :['toolbox'],
            pixelRatio: 2,
            iconStyle: {
              borderColor: "#fff",
            },
          },
          //æ’¤é”€ä¿®æ”¹
          restore: {
            iconStyle: {
              borderColor: "#fff",
            },
          },
          //æ¡çŠ¶å›¾æŒ‰é’®
          mybarbotton: {
            show: true,
            title: "æ¡å½¢å›¾",
            icon: "image://svg/barchart.svg",
            onclick: function () {
              nowOption = 1;
              changeOption(1);
            },
          },
          //åœ°å›¾æŒ‰é’®
          mymapbutton: {
            show: true,
            title: "ä¸–ç•Œåœ°å›¾",
            icon: "image://svg/map.svg",
            onclick: function () {
              nowOption = 0;
              changeOption(0);
            },
          },
        },
      },
    };

    mychart.setOption(mapOption, true);
    // let currentOption = mapOption;
    // setInterval(function () {
    //     currentOption = currentOption === mapOption ? barOption : mapOption;
    //     mychart.setOption(currentOption, true);
    // }, 2000);
    // mychart.on('click', function (params) {
    //     console.log(params);//æ­¤å¤„å†™ç‚¹å‡»äº‹ä»¶å†…å®¹
    //     if (params.data !== undefined)
    //         console.log(params.data.name);//æ­¤å¤„å†™ç‚¹å‡»äº‹ä»¶å†…å®¹
    //     // console.log(params[2]);//æ­¤å¤„å†™ç‚¹å‡»äº‹ä»¶å†…å®¹
    // });

    //ç¼©æ”¾èŒƒå›´
    const zoomSize = 4;
    //å½“å‰è§†å›¾æ¨¡å¼
    var nowOption = 0;

    mychart.on("click", function (params) {
      if (nowOption === 1) {
        //æ­¤æ—¶ä¸ºæ¡å½¢å›¾
        var dataAxis = data.map(function (item) {
          return item.name;
        });
        mychart.dispatchAction({
          type: "dataZoom",
          startValue: dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)],
          endValue:
            dataAxis[
            Math.min(params.dataIndex + zoomSize / 2, data.length - 1)
            ],
        });
        console.log(params.name);
        var tmp = params.name;
        if (tmp === "United States") tmp = "United States of America";
        else if (tmp === "Russia") tmp = "Russian Federation";
        else if (tmp === "Iran") tmp = "Iran (Islamic Republic of)";
        else if (tmp === "Dem. Rep. Korea") tmp = "Korea North";
        else if (tmp === "Korea") tmp = "Korea South";
        guojia = tmp;

        readdata(dataName);
      } else {
        //æ­¤æ—¶ä¸ºåœ°å›¾
        // console.log(params.data);//æ­¤å¤„å†™ç‚¹å‡»äº‹ä»¶å†…å®¹
        if (params.data !== undefined) {
          var tmp = params.data.name;
          if (tmp === "United States") tmp = "United States of America";
          else if (tmp === "Russia") tmp = "Russian Federation";
          else if (tmp === "Iran") tmp = "Iran (Islamic Republic of)";
          else if (tmp === "Dem. Rep. Korea") tmp = "Korea North";
          else if (tmp === "Korea") tmp = "Korea South";
          guojia = tmp;
          console.log(guojia); //æ­¤å¤„å†™ç‚¹å‡»äº‹ä»¶å†…å®¹
          readdata(dataName);
        }

        // console.log(params[2]);//æ­¤å¤„å†™ç‚¹å‡»äº‹ä»¶å†…å®¹
      }
    });

    //æ”¹å˜è§†å›¾ä¸ºåœ°å›¾æˆ–æ¡å½¢å›¾
    function changeOption(nowOption) {
      if (nowOption === 0) mychart.setOption(mapOption, true);
      else mychart.setOption(barOption, true);
    }

    //è¯·æ±‚csvæ–‡ä»¶
    function getCSV(url, f) {
      let xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", url, false); // åŒæ­¥å¤„ç†è¿”å›
      xmlHttp.onreadystatechange = function callback() {
        if (xmlHttp.readyState === 4) {
          //4ä»£è¡¨æ‰§è¡Œå®Œæˆ
          if (xmlHttp.status === 200) {
            //console.log(xmlHttp.responseText);
            f.call(this, xmlHttp.responseText);
          }
        }
      };
      xmlHttp.setRequestHeader(
        "Content-Type",
        "application/x-www-form-urlencoded;"
      );
      xmlHttp.send(null);
    }

    //csvå­—ç¬¦ä¸² to  Array
    function CSV(csvString) {
      let data = [];
      let relArr = csvString.split("\r\n"); // '\r'
      if (relArr.length > 1) {
        let title = relArr[0].split(",");
        let title_arr = title.keys();
        for (let key = 1, len = relArr.length - 1; key < len; key++) {
          let values = relArr[key];
          let objArr = values.split(",");
          let obj = {};
          for (let i = 0; i < title.length; i++) {
            obj[title[title_arr.next().value]] = objArr[i];
          }
          data.push(obj);
          title_arr = title.keys();
        }
      }
      return data;
    }

    function readData(tname) {
      filePath = "data/" + tname + ".csv";
      getCSV(filePath, function (data) {
        filedata = CSV(data);
        // console.log(thedata);
      });
      // console.log(filedata);
      // var tmp = filedata[0]['"Country"'];
      // tmp = tmp.substring(1, tmp.length + -2);
      // console.log(tmp);
      data = filedata.map((item) => {
        var tmp = item["Country"];
        if (tmp === "United States of America") tmp = "United States";
        else if (tmp === "Russian Federation") tmp = "Russia";
        else if (tmp === "Iran (Islamic Republic of)") tmp = "Iran";
        else if (tmp === "Korea North") tmp = "Dem. Rep. Korea";
        else if (tmp === "Korea South") {
          tmp = "Korea";
        }
        // console.log(tmp[0]);
        // console.log(tmp[tmp.length - 1]);
        return {
          name: tmp,
          value: parseFloat(item[col]),
        };
      });
      data.sort(function (a, b) {
        return a.value - b.value;
      });
    }

    function changeView() {
      readData(tableName);
      mapOption.series[0].data = data;
      if (tableName === "1") {
        mapOption.title.text = "ä¸–ç•Œå„å›½è„‚è‚ªæ‘„å…¥æ¥è‡ªäº " + col + " çš„å æ¯”";
      } else if (tableName === "2") {
        mapOption.title.text = "ä¸–ç•Œå„å›½çƒ­é‡æ‘„å…¥æ¥è‡ªäº " + col + " çš„å æ¯”";
      } else if (tableName === "3") {
        mapOption.title.text = "ä¸–ç•Œå„å›½é£Ÿç‰©æ‘„å…¥é‡æ¥è‡ªäº " + col + " çš„å æ¯”";
      } else if (tableName === "4") {
        mapOption.title.text = "ä¸–ç•Œå„å›½è›‹ç™½æ‘„å…¥æ¥è‡ªäº " + col + " çš„å æ¯”";
      }
      barOption.series.data = data.map(function (item) {
        return item.value;
      });
      barOption.yAxis.data = data.map(function (item) {
        return item.name;
      });
      mychart.clear();
      changeOption(nowOption);
    }
  </script>
  <!-- ä»ªè¡¨ç›˜ -->
  <script>
    var myChart_ = echarts.init(document.getElementById("hill"));
    var kiddo_size = 160;
    var p_fat = 41;
    option_ = {
      //backgroundColor: "#16294a", // å›¾è¡¨èƒŒæ™¯è‰²
      tooltip: {
        formatter: "{a} <br/>{b} : {c}%",
      },
      toolbox: {
        feature: {
          restore: {},
          saveAsImage: {},
        },
        show: false,
      },
      series: [
        {
          //ç¬¬1ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["20%", "33%"], //è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 13,
              name: "è°·ç‰©ğŸŒ½",
            },
          ],
        },
        {
          //ç¬¬2ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["40%", "33%"], //**è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®**
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 13,
              name: "è”¬æœğŸ¥¦",
            },
          ],
        },
        {
          //ç¬¬3ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["60%", "33%"], //**è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®**
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 13,
              name: "ç³–åŠç³–ç±»ä½œç‰©ğŸ¬",
            },
          ],
        },
        {
          //ç¬¬4ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["80%", "33%"], //**è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®**
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 13,
              name: "è‚‰ç±»ğŸ¥©",
            },
          ],
        },
        {
          //ç¬¬5ä¸ª
          radius: "60%", //ä»ªè¡¨ç›˜å¤§å°
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["20%", "83%"], //ä»ªè¡¨ç›˜çš„ä½ç½®
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 12,
              name: "è›‹ç±»ğŸ¥š",
            },
          ],
        },
        {
          //ç¬¬6ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["40%", "83%"], //**è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®**
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 12,
              name: "å¥¶ç±»ğŸ¥›",
            },
          ],
        },
        {
          //ç¬¬7ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["60%", "83%"], //**è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®**
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 12,
              name: "é…’ç²¾é¥®æ–™ğŸº",
            },
          ],
        },
        {
          //ç¬¬8ä¸ª
          radius: "60%",
          startAngle: 180, //å¼€å§‹è§’åº¦ å·¦ä¾§è§’åº¦
          endAngle: 0, //ç»“æŸè§’åº¦ å³ä¾§
          type: "gauge",
          center: ["80%", "83%"], //**è°ƒæ•´ä»ªè¡¨ç›˜çš„ä½ç½®**
          axisLine: {
            lineStyle: {
              width: 6,
              color: [
                [0.25, "#4cc9f0"],
                [0.5, "#3f37c9"],
                [0.75, "#7209b7"],
                [1, "#f72585"],
              ],
            },
          },
          pointer: {
            icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
            length: "12%",
            width: 16,
            offsetCenter: [0, "-60%"],
            itemStyle: {
              color: "auto",
            },
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: "auto",
              width: 2,
            },
          },
          splitLine: {
            length: 10,
            lineStyle: {
              color: "auto",
              width: 5,
            },
          },
          axisLabel: {
            color: "#464646",
            fontSize: 20,
            distance: -60,
            formatter: function (value) {
              if (value === 0.875) {
                return "A";
              } else if (value === 0.625) {
                return "B";
              } else if (value === 0.375) {
                return "C";
              } else if (value === 0.125) {
                return "D";
              }
              return "";
            },
          },
          title: {
            offsetCenter: [0, "35%"],
            fontSize: 20,
            color: "#fff",
          },
          detail: {
            fontSize: 20,
            offsetCenter: [0, "0%"],
            valueAnimation: true,
            formatter: function (value) {
              return Math.round(value) + "%";
            },
            color: "auto",
          },
          data: [
            {
              value: 12,
              name: "é±¼å’Œæµ·é²œğŸŸ",
            },
          ],
        },
      ],
    };

    myChart_.setOption(option_, true);
    var gauge = document.getElementById("hill"); //getElementByIdæ–¹æ³•å¯è¿”å›å¯¹æ‹¥æœ‰æŒ‡å®šidçš„ç¬¬ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨
    var { width, height } = getComputedStyle(gauge);
    var width_num = parseInt(width);
    var height_num = parseInt(height);
    var minAngle = 0;
    var maxAngle = 180;
    var maxValue = 100;
    var dataRatio = maxValue / maxAngle;

    function changeValue(event) {
      var x = event.offsetX;
      var y = event.offsetY;
      // console.log(x);
      // console.log(y);

      if (
        //ç¬¬1ä¸ª
        x > 0.2 * width_num - 0.3 * height_num &&
        x < 0.2 * width_num + 0.3 * height_num &&
        y < 0.35 * height_num &&
        y > 0
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.33 * height_num - y, 0.2 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[0].data[0].value = value;
      } else if (
        //ç¬¬2ä¸ª
        x > 0.4 * width_num - 0.3 * height_num &&
        x < 0.4 * width_num + 0.3 * height_num &&
        y < 0.35 * height_num &&
        y > 0
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.33 * height_num - y, 0.4 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[1].data[0].value = value;
      } else if (
        //ç¬¬3ä¸ª
        x > 0.6 * width_num - 0.3 * height_num &&
        x < 0.6 * width_num + 0.3 * height_num &&
        y < 0.35 * height_num &&
        y > 0
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.33 * height_num - y, 0.6 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[2].data[0].value = value;
      } else if (
        //ç¬¬4ä¸ª
        x > 0.8 * width_num - 0.3 * height_num &&
        x < 0.8 * width_num + 0.3 * height_num &&
        y < 0.35 * height_num &&
        y > 0
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.33 * height_num - y, 0.8 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[3].data[0].value = value;
      } else if (
        //ç¬¬5ä¸ª
        x > 0.2 * width_num - 0.3 * height_num &&
        x < 0.2 * width_num + 0.3 * height_num &&
        y < height_num &&
        y > 0.53 * height_num
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.83 * height_num - y, 0.2 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[4].data[0].value = value;
      } else if (
        //ç¬¬6ä¸ª
        x > 0.4 * width_num - 0.3 * height_num &&
        x < 0.4 * width_num + 0.3 * height_num &&
        y < height_num &&
        y > 0.53 * height_num
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.83 * height_num - y, 0.4 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[5].data[0].value = value;
      } else if (
        //ç¬¬7ä¸ª
        x > 0.6 * width_num - 0.3 * height_num &&
        x < 0.6 * width_num + 0.3 * height_num &&
        y < height_num &&
        y > 0.53 * height_num
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.83 * height_num - y, 0.6 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[6].data[0].value = value;
      } else if (
        //ç¬¬8ä¸ª
        x > 0.8 * width_num - 0.3 * height_num &&
        x < 0.8 * width_num + 0.3 * height_num &&
        y < height_num &&
        y > 0.53 * height_num
      ) {
        // å½“å‰ç‚¹å‡»ä½ç½®çš„è§’åº¦.
        var currentAngle =
          (Math.atan2(0.83 * height_num - y, 0.8 * width_num - x) * 180) /
          Math.PI;
        // è¾¹ç•Œå¤„ç†

        if (currentAngle < minAngle || currentAngle > maxAngle) {
          let _angle = Math.abs(currentAngle);
          if (_angle > 90) {
            currentAngle = maxAngle;
          } else {
            currentAngle = minAngle;
          }
        }
        // è½¬æ¢å›æ•°æ®å€¼, è¿™é‡Œå°±æ˜¯å®é™…çš„å€¼, é»˜è®¤ä¿ç•™2ä½å°æ•°.
        let value = (currentAngle * dataRatio).toFixed(2);

        option_.series[7].data[0].value = value;
      }
      kiddo_size =
        0.5 *
        (parseFloat(option_.series[0].data[0].value) +
          0.5 * parseFloat(option_.series[1].data[0].value) +
          5 * parseFloat(option_.series[2].data[0].value) +
          5 * parseFloat(option_.series[3].data[0].value) +
          2 * parseFloat(option_.series[4].data[0].value) +
          3 * parseFloat(option_.series[5].data[0].value) +
          5 * parseFloat(option_.series[6].data[0].value) +
          3.5 * parseFloat(option_.series[7].data[0].value));
      p_fat = 100 / (1 + Math.pow(2.7, -kiddo_size / 10 + 15)) - 22.5;
      if (p_fat <= 0) p_fat = 2.0;
      console.log(p_fat);
      if (p_fat < 5) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/10.jpg";
      } else if (p_fat < 10) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/9.jpg";
      } else if (p_fat < 16) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/8.jpg";
      } else if (p_fat < 22) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/7.jpg";
      } else if (p_fat < 29) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/6.jpg";
      } else if (p_fat < 37) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/5.jpg";
      } else if (p_fat < 46) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/4.jpg";
      } else if (p_fat < 56) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/3.jpg";
      } else if (p_fat < 67) {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/2.jpg";
      } else {
        option1.title.text = "æ‚£è‚¥èƒ–æ¦‚ç‡: " + p_fat + "%";
        option1.series[0].data[0].symbol = "image://svg/1.jpg";
      }
      // option1.series[0].data[0].symbolSize[0] = kiddo_size; //æ”¹å˜å›¾ç‰‡å¤§å°
      // option1.series[0].data[0].symbolSize[1] = kiddo_size; //æ”¹å˜å›¾ç‰‡å¤§å°
      // console.log("p_fat:");
      // console.log(p_fat);
      yourChart.setOption(option1);
      myChart_.setOption(option_);
    }

    myChart_._zr.on("mousedown", function (event) {
      changeValue(event);
      myChart_._zr.on("mousemove", changeValue);
    });
    myChart_._zr.on("mouseup", function (event) {
      myChart_._zr.off("mousemove", changeValue);
    });

    var yourChart = echarts.init(document.getElementById("svg"));
    option1 = {
      animationDuration: 0,
      //backgroundColor: "#fff",
      title: {
        text: "æ‚£è‚¥èƒ–æ¦‚ç‡:" + p_fat,
        textStyle: {
          color: "#f15bb5",
        },
      },
      xAxis: {
        data: [""],
        axisTick: { show: false },
        axisLine: { show: false },
        axisLabel: {
          color: "#e54035",
        },
      },
      yAxis: {
        splitLine: { show: false },
        axisTick: { show: false },
        axisLine: { show: false },
        axisLabel: { show: false },
      },
      color: ["#e54035"],
      series: [
        {
          center: ["0%", "0%"],
          name: "glyph",
          type: "pictorialBar",
          // barGap: "-100%",
          // symbolPosition: "end",
          symbolSize: 80,
          symbolOffset: [0, "40%"],
          data: [
            {
              value: 27,
              // symbol: pathSymbols.reindeer,
              symbol: "image://svg/4.jpg",
              symbolSize: [270, 180], //å›¾ç‰‡å¤§å°
            },
          ],
        },
      ],
    };

    yourChart.setOption(option1);
  </script>
  <!-- d3å †å æ¡å½¢å›¾ -->
  <script>
    var total_length = Array();
    var original_length = Array();
    var dataset = Array();
    var feature_names = Array();
    var country_names = Array();
    var obesity_values = Array();
    var colors1 = [
      "#f94144",
      "#f3722c",
      "#f8961e",
      "#f9844a",
      "#f9c74f",
      "#90be6d",
      "#43aa8b",
      "#4d908e",
      "#577590",
    ];
    colors1 = colors1.reverse();
    var height = 470;
    var width = 350;

    var svg = d3.select("body")
                .select("#nsy")
                .append("svg")
                .attr("height", height)
                .attr("width", width)
                // .attr('transform','translate(20,0)');

    var start_x = 90;
    var start_y = 50;
    var recheight = 30;
    var order = 1; // è¡¨ç¤ºå½“å‰çŠ¶æ€ï¼Œ1è¡¨ç¤ºæ˜¾ç¤ºå‰åä¸ªï¼Œ0è¡¨ç¤ºæ˜¾ç¤ºååä¸ª
    var get_names = 1;

    readAndDraw();

    function readAndDraw() {
      d3.csv("data/3.csv").then((data) => {
        dataset = Array();
        total_length = Array();
        original_length = Array();
        getFeatureNames(data);
        getOrderedData(data);

        drawRect();
        drawTextRect();
      });
    }

    function getFeatureNames(data) {
      if (get_names === 1) {
        let index = 0;
        for (let key in data[0]) {
          if (index >= 1 && index <= 9) feature_names.push(key);
          index += 1;
        }
        get_names = 0;
      }
      console.log(feature_names);
    }

    function drawAxis() {
      // æ¨ªè½´
      xScale = d3
        .scaleLinear()
        .domain([0, d3.max(obesity_values)])
        .range([0, d3.max(total_length)]);

      var xAxis = d3.axisBottom(xScale);
      svg.select(".gx").remove();
      svg
        .append("g")
        .attr("class", "gx")
        .attr("transform", "translate(" + start_x + "," + (start_y + 390) + ")")

        .call(xAxis);

      // çºµè½´
      var yScale = d3
        .scaleBand()
        .domain(country_names)
        .range([start_y, start_y + 390]);

      var yAxis = d3.axisLeft(yScale);
      svg.select(".yg").remove();

      svg
        .append("g")
        .attr("class", "yg")
        .attr("transform", "translate(89,0)")
        .call(yAxis);
    }

    function drawRect() {
      drawAxis();
      for (let i = 0; i < dataset.length; i++)
        svg.selectAll(".rect" + i).remove();

      for (let i = 0; i < dataset.length; i++) {
        let sum_start = 0;
        console.log(total_length[i]);
        svg
          .selectAll(".rect" + i)
          .data(dataset[i])
          .enter()
          .append("rect")
          .attr("class", "rect" + i)
          .attr("x", (d, j) => {
            if (j === 0) sum_start += start_x;
            else
              sum_start +=
                (dataset[i][j - 1] / d3.sum(dataset[i])) * total_length[i];
            return sum_start;
          })
          .attr("y", (d, j) => {
            return start_y + i * (recheight + 10);
          })
          .attr("width", (d, j) => {
            return (d / d3.sum(dataset[i])) * total_length[i];
          })
          .attr("height", recheight)
          .attr("fill", (d, j) => {
            return colors1[j];
          })
          .on("click", () => {
            total_length[i] = 150;
            changeRect(i);
            drawAxis();
          })
          .on("dblclick", () => {
            total_length[i] = original_length[i];
            changeRect(i);
            drawAxis();
          });
      }
    }

    function getOrderedData(data) {
      if (order === 1)
        data.sort((a, b) => {
          return b.Obesity - a.Obesity;
        });
      else
        data.sort((a, b) => {
          return a.Obesity - b.Obesity;
        });
      //å‰åæˆ–ååObesity
      country_names = Array();
      obesity_values = Array();
      for (let i = 0; i < 10; i++) {
        obesity_values.push(parseFloat(data[i].Obesity));
        country_names.push(data[i].Country);
        //å–å‰åä¸ªç‰¹å¾
        if (order === 1) {
          total_length.push(data[i].Obesity * 3);
          original_length.push(data[i].Obesity * 3);
        } else {
          total_length.push(data[i].Obesity * 30);
          original_length.push(data[i].Obesity * 30);
        }
        const first10Entries = Object.entries(data[i]).filter(
          (_, index) => index > 0 && index <= 9
        );
        const obj = Object.fromEntries(
          first10Entries.map(([key, value]) => [
            key,
            isNaN(+value) ? value : +value,
          ])
        );
        // console.log(obj);
        let data_temp = Array();
        for (let key in obj) data_temp.push(obj[key]);
        dataset.push(data_temp);
      }
      //æ”¹å˜ order çš„å€¼
      order = order === 1 ? 0 : 1;
    }

    function changeRect(i) {
      let sum_start = 0;
      d3.selectAll(".rect" + i)
        .transition()
        .duration(500)
        .attr("x", (d, j) => {
          if (j === 0) sum_start += start_x;
          else
            sum_start +=
              (dataset[i][j - 1] / d3.sum(dataset[i])) * total_length[i];
          return sum_start;
        })
        .attr("width", (d, j) => {
          return (d / d3.sum(dataset[i])) * total_length[i];
        });
    }

    function drawTextRect() {
      svg
        .selectAll(".textRect")
        .data(feature_names)
        .enter()
        .append("rect")
        .attr("class", "textRect")
        .attr("x", 150 + start_x)
        .attr("y", (d, i) => {
          return start_y + i * (recheight + 15);
        })
        .attr("width", 20)
        .attr("height", 10)
        .attr("fill", (d, i) => {
          return colors1[i];
        });

      svg
        .selectAll("rectText")
        .data(feature_names)
        .enter()
        .append("text")
        .attr("class", "rectText")
        .attr("x", 170 + start_x)
        .attr("y", (d, i) => {
          return start_y + i * (recheight + 15) + 10;
        })
        .attr("font-size", 10)
        .attr("text-anchor", "left")
        .style("user-select", "none")
        .attr("fill", "white")
        .text((d) => {
          return d;
        });
    }
  </script>
</body>

</html>